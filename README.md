# Practice Intelligence Library

This repository contains a standalone practice intelligence library that links climate anomalies,
regional context, and agronomic practices to observed outcomes. It provides:

* Synthetic seed datasets describing example anomaly events and outcomes.
* Scripts to build a model-ready dataset, train a lightweight Random Forest correlation model,
  evaluate the trained model, and export a human-readable library view.
* A recommender module that can produce context-aware practice recommendations backed by the model.

## Project Structure

```
practice-library/
├── data/
│   ├── training_examples.csv         # Synthetic anomaly and practice observations
│   ├── training_dataset.csv          # Model-ready dataset generated by the builder script
│   ├── practice_metadata.yml         # Descriptions and context for each practice
│   ├── region_metadata.yml           # Contextual metadata for each region
│   ├── outcome_metrics.csv           # Observed changes before/after practices
│   └── encodings.json                # Category encodings used by the model
├── library/
│   ├── schema.py                     # Dataclasses and encoding helpers
│   ├── loader.py                     # CSV/YAML loaders and encoding utilities
│   ├── correlation_model.py          # Custom Random Forest implementation
│   └── recommender.py                # Context-aware recommendation helpers
├── models/                           # Generated model artifacts (ignored in git)
├── scripts/
│   ├── build_training_dataset.py     # Merge metadata and build encodings
│   ├── train_practice_correlations.py# Train the Random Forest model
│   ├── evaluate_effectiveness.py     # Report R² and feature importances
│   └── export_library_view.py        # Export ranked practice_library.yml
└── library/practice_library.yml      # Human-readable practice library export
```

## Usage

From the repository root run the following commands in order:

```bash
python scripts/build_training_dataset.py
python scripts/train_practice_correlations.py  # produces models/correlation_model.pkl
python scripts/evaluate_effectiveness.py
python scripts/export_library_view.py
```

After training you can request recommendations programmatically:

```python
from library.recommender import get_recommendations

recommendations = get_recommendations(
    crop="coffee",
    anomaly_type="drought",
    spi=-1.5,
    ndvi_anomaly=-0.2,
    soil_type="volcanic_loam",
    stage="flowering",
)
```

The recommender returns a list of candidate practices sorted by the model-estimated effectiveness for
the provided context.
